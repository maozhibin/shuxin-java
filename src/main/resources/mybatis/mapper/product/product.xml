<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.baoquan.shuxin.dao.product.ProductDao" >
  <resultMap id="BaseResultMap" type="com.baoquan.shuxin.model.product.Product" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="frequent" property="frequent" jdbcType="TINYINT" />
    <result column="type" property="type" jdbcType="TINYINT" />
    <result column="product_class_id" property="productClassId" jdbcType="INTEGER" />
    <result column="product_base_id" property="productBaseId" jdbcType="INTEGER" />
    <result column="area_id" property="areaId" jdbcType="INTEGER" />
    <result column="icon" property="icon" jdbcType="VARCHAR" />
    <result column="used" property="used" jdbcType="INTEGER" />
    <result column="dateline" property="dateline" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="reflect_class" property="reflectClass" jdbcType="VARCHAR" />
  </resultMap>
	
	 <select id="countByName" resultType="java.lang.Integer">
       SELECT
			COUNT(1)
		FROM
			product p
		LEFT JOIN `user` u ON p.user_id = u.id
     	where 1 = 1
		<if test="name != null">
	         and p.`name`=#{name}
	         or u.username=#{name}
	    </if>
  </select>

  <select id="productList" resultType="java.util.Map">
		SELECT
			p.dateline,
			p.`name`,
			p.type,
			p.`status`,
			s.price,
			a.`name` areaName,
			u.username seller
		FROM
			product p
		LEFT JOIN `user` u ON p.user_id = u.id
		LEFT JOIN area a ON p.area_id = a.id
		LEFT JOIN product_billings s ON s.product_id = p.id
		WHERE
			1 = 1
		<if test="name != null">
	         and p.`name`=#{name}
	         or u.username=#{name}
	    </if>
	    <if test="page != null">
	              	limit ${page.startIndex},${page.pageSize};
	     </if>
  </select>
</mapper>