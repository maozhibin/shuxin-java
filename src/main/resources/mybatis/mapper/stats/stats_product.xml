<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.baoquan.shuxin.dao.product.StatsProductDao" >
  <resultMap id="BaseResultMap" type="com.baoquan.shuxin.model.stats.StatsProduct" >
    <id column="product_id" property="productId" jdbcType="BIGINT" />
    <result column="total_amount" property="totalAmount" jdbcType="DECIMAL" />
    <result column="order_num" property="orderNum" jdbcType="BIGINT" />
    <result column="purchase_num" property="purchaseNum" jdbcType="BIGINT" />
    <result column="dateline" property="dateline" jdbcType="BIGINT" />
  </resultMap>
  
  <select id="productTop" resultType="java.util.Map">
	  SELECT
		p.`name`,
		c.`name` className,
		s.total_amount,
		s.order_num,
		s.purchase_num,
		u.username,
		concat(
			FORMAT(
				(
					s.order_num / (
						SELECT
							COUNT(*)
						FROM
							user_product
					)
				) * 100,
				2
			),
			'%'
		) AS rate
	FROM
		product p
	LEFT JOIN product_class c ON p.product_class_id = c.id
	LEFT JOIN stats_product s ON s.product_id = p.id
	LEFT JOIN `user` u ON u.id = p.user_id
	ORDER BY
		s.total_amount DESC
	LIMIT 0,
	 10
  </select>
  
</mapper>